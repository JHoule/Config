
autoload -U colors && colors


# Powerline Special Characters.
CHAR_POWERLINE_SEP_RIGHT_FILLED="î‚°" # \ue0b0
CHAR_POWERLINE_SEP_RIGHT="î‚±" # \ue0b1
CHAR_POWERLINE_SEP_LEFT_FILLED="î‚²"  # \ue0b2
CHAR_POWERLINE_SEP_LEFT="î‚³"  # \ue0b3
CHAR_POWERLINE_BRANCH="î‚ " # \ue0a0


# Unicode Special Characters.
CHAR_PLUS_MINUS_SIGN="Â±" # \u00b1
CHAR_GEAR="âš™" # \u2699
CHAR_WARNING="âš " # \u26a0
CHAR_HIGH_VOLTAGE="âš¡" # \u26a1
CHAR_CHECK_HEAVY="âœ”" # \u2714
CHAR_BALLOT_HEAVY="âœ˜" # \u2718
CHAR_ARROW_UP_RIGHT="âž¦" # \u27a6


##
# https://en.wikibooks.org/wiki/Unicode/List_of_useful_symbols
# https://en.wikipedia.org/wiki/Geometric_Shapes
# http://www.alanflavell.org.uk/unicode/unidata25.html

# âª 23EA Black left-pointing double triangle
# â© 23E9 Black right-pointing double triangle
# â« 23EB Black up-pointing double triangle
# â¬ 23EC Black down-pointing double triangle
# â­ 23ED Black right-pointing pointer double triangle with vertical bar
# â® 23EE Black left-pointing pointer double triangle with vertical bar
# â–º 25BA Black right-pointing pointer
# â—„ 25C4 Black left-pointing pointer
# â–² 25B2 Black up-pointing triangle
# â–¼ 25BC Black down-pointing triangle
# â–³ 25B3 White up-pointing triangle
# â–½ 25BD White down-pointing triangle
# â—‰ 25C9 Fisheye
# â—Ž 25CE Bullseye
# âœ‚ 2702 Black Scissors
# âœ„ 2704 White Scissors
# âœ… 2705 White heavy check mark
# âœ“ 2713 Check mark
# âœ” 2714 Heavy check mark
# âœ• 2715 Multiplication
# âœ– 2716 Heavy multiplication
# âœ— 2717 Ballot X
# âœ˜ 2718 Heavy ballot X
# âŒ 274C Cross mark

# â‹® 22EE vellip, vertical ellipsis
# â‹¯ 22EF hellip, horizontal ellipsis
# â‹° 22F0 utdot, rising dots, up right diagonal ellipsis
# â‹± 22F1 dtdot, falling dots, down right diagonal ellipsis
# ã€ˆ 27E8 lang , left angle bracket
# ã€‰ 27E9 rang, right angle bracket

# â†	 2190 left arrow
# â†‘	 2191 up arrow
# â†’	 2192 right arrow
# â†“	 2193 down arrow
# âŽ	 23CE carriage return symbol
# âŒ«	 232B erase to the left (backspace)
# â£	 2423 space symbol
# â–¡	 25A1 square
# â˜…	 2605 starf, bigstar, black star
# â˜†	 2606 white star
# â›¤	 26E4 pentagram
# â˜	 2610 ballot box
# â˜‘	 2611 ballot box with check
# â˜’	 2612 ballot box with X
# â˜›	 261B black right pointing finger
# â˜ž	 261E white right pointing finger
# âšœ	 269C fleur-de-lys
# âœ“	 2713 check mark
# âœ—	 2717 cross mark
# â¸º	 2E3A two-em dash
# â¸»	 2E3B three-em dash
# ã€ƒ	 3003 ditto

# ðŸŒ‘ 1F311 new moon
# ðŸŒ“ 1F313 first quarter moon
# ðŸŒ• 1F315 full moon
# ðŸŒ— 1F317 last quarter moon
# ðŸŒ™ 1F319 crescent moon
# ðŸŒ  1F320 shooting star


#
# 16 Terminal Colors
# -- ---------------
#  0 black
#  1 red
#  2 green
#  3 yellow
#  4 blue
#  5 magenta
#  6 cyan
#  7 white
#  8 bright black
#  9 bright red
# 10 bright green
# 11 bright yellow
# 12 bright blue
# 13 bright magenta
# 14 bright cyan
# 15 bright white
#
function jph_colstr {
	# jph_colstr 1:string_to_print 2:fg_color 3:bg_color
	# jph_colstr "JPH" red green
	local str="%{%F{$2}%K{$3}%}$1%{%k%f%}"
	echo -n $str
	#echo -n $1 # Removes formatting (for debugging).
}

function jph_refresh_rprompt {
	sleep 1
	JPH_RPROMPT=$(date)_%F{2}î‚°%f_$$
}

function jph_refresh_rprompt_async {
	# Clear RPROMPT if desired.
	if [[ "$JPH_RPROMPT_ASYNC_CLEAR" = true ]]; then
		RPROMPT=
	fi

	# Kill any outstanding process.
	if (( JPH_RPROMPT_PID > 0 )); then
		kill -KILL "$JPH_RPROMPT_PID" &>/dev/null
		JPH_RPROMPT_PID=0
	fi

	# Launch new backround process, keeping its pid.
	_jph_refresh_rprompt_async &!
	JPH_RPROMPT_PID=$!
}

function _jph_refresh_rprompt_async {
	# Compute a new RPROMPT value.
	jph_refresh_rprompt

	# Store in a temp file (because we are a subprocess job, so wrong RPROMPT variable).
	printf "%s" $JPH_RPROMPT > ${JPH_RPROMPT_TMPFILE}
	#cat ${JPH_RPROMPT_TMPFILE}

	# Signal shell using a window resize signal.
	kill -WINCH $$
}

function jph_do_refresh_prompt {
	# Refresh RPROMPT variable.
	if [[ -e "${JPH_RPROMPT_TMPFILE}" ]]; then
		RPROMPT=$(cat "${JPH_RPROMPT_TMPFILE}")
	fi

	# Redisplay prompt.
	zle && zle reset-prompt
}

function jph_precmd {
	# Print pre-prompt, if any.
	if [[ ! -z ${JPH_PPROMPT} ]]; then
		print -rP ${JPH_PPROMPT}
	fi

	# Refresh async rprompt, if any.
	if [[ "$JPH_RPROMPT_ASYNC" = true && ! -z "$JPH_RPROMPT" ]]; then
		jph_refresh_rprompt_async
	fi
}

function jph_init {
	#echo DBG_JPH_INIT
	PROMPT=${JPH_PROMPT}
	RPROMPT=${JPH_RPROMPT}
	function precmd { jph_precmd }

	if [[ ! -z "$JPH_RPROMPT" ]]; then
		if [[ "$JPH_RPROMPT_ASYNC" = true ]]; then
			JPH_RPROMPT_TMPFILE="${TMPPREFIX}_jph_rprompt"
			trap jph_do_refresh_prompt WINCH
			jph_refresh_rprompt_async
		fi
	#else
	#	echo "Ignoring RPROMPT settings."
	fi
}